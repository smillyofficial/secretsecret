<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 12 Pro Max - Ultra Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow: hidden;
            user-select: none;
            background: #000;
        }

        .glass {
            backdrop-filter: blur(25px) saturate(200%);
            -webkit-backdrop-filter: blur(25px) saturate(200%);
            background: rgba(15, 15, 20, 0.75);
            border: 1px solid rgba(255, 255, 255, 0.12);
        }

        .window-instance {
            transition: opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1), transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            transform-origin: center bottom;
        }

        .animate-float { animation: float 3s ease-in-out infinite; }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .wallpaper-container {
            transition: filter 0.5s ease, background-image 0.8s ease-in-out;
        }

        .music-bar {
            transition: height 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #game-canvas {
            background: linear-gradient(to bottom, #0f172a, #1e1b4b);
            cursor: crosshair;
        }
    </style>
</head>
<body class="h-screen w-screen overflow-hidden">

    <!-- Wallpaper Layer -->
    <div id="desktop-bg" class="fixed inset-0 bg-cover bg-center transition-all duration-1000 wallpaper-container"></div>
    <div id="brightness-overlay" class="fixed inset-0 bg-black pointer-events-none z-[9999] opacity-0"></div>

    <div id="desktop" class="h-screen w-screen relative z-10 flex flex-col">
        
        <!-- Desktop Grid -->
        <div id="desktop-icons" class="p-8 grid grid-flow-col grid-rows-[repeat(auto-fill,110px)] gap-4 w-fit h-full"></div>

        <!-- Windows Container -->
        <div id="window-container" class="absolute inset-0 pointer-events-none z-20"></div>

        <!-- Start Menu -->
        <div id="start-menu" class="fixed hidden bottom-24 left-1/2 -translate-x-1/2 w-[600px] h-[520px] rounded-[48px] p-10 z-[4000] shadow-2xl glass text-white flex flex-col items-center animate-window">
            <div class="w-full relative mb-10">
                <i data-lucide="search" class="absolute left-6 top-1/2 -translate-y-1/2 opacity-30 w-5 h-5"></i>
                <input class="w-full bg-white/5 border border-white/10 rounded-2xl py-5 pl-16 pr-6 text-sm outline-none focus:ring-2 focus:ring-blue-500/50" placeholder="Search apps, settings, and files...">
            </div>
            <div id="start-grid" class="grid grid-cols-4 gap-x-8 gap-y-10 w-full overflow-y-auto"></div>
        </div>

        <!-- Taskbar -->
        <div class="fixed bottom-8 left-0 w-full flex justify-center z-[5000]">
            <div id="taskbar" class="flex items-center gap-2 p-2 px-5 rounded-[32px] shadow-2xl glass transition-all duration-500">
                <button onclick="toggleStart(event)" class="w-14 h-14 rounded-[22px] bg-gradient-to-tr from-blue-700 to-sky-400 flex items-center justify-center hover:scale-110 active:scale-95 transition shadow-xl group">
                    <i data-lucide="layout-grid" class="text-white w-7 h-7 group-hover:rotate-12 transition-transform"></i>
                </button>
                <div class="w-px h-10 bg-white/10 mx-3"></div>
                <div id="taskbar-apps" class="flex items-center gap-3"></div>
                <div class="w-px h-10 bg-white/10 mx-3"></div>
                <div class="flex items-center gap-5 px-6 h-14 hover:bg-white/5 rounded-[22px] cursor-pointer transition text-white">
                    <div class="flex flex-col items-end">
                        <span id="taskbar-time" class="text-sm font-black">00:00</span>
                        <span id="taskbar-date" class="text-[9px] font-bold opacity-40 uppercase tracking-tighter">JAN 01</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const state = {
            wallpaper: 'https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?auto=format&fit=crop&w=1920&q=80',
            openWindows: [], // Array of objects: { id, type, title }
            activeWindow: null,
            folders: JSON.parse(localStorage.getItem('w12_folders')) || [
                { id: 'folder_1', name: 'Work Documents', x: 20, y: 20 }
            ],
            apps: {
                explorer: { name: 'File Explorer', icon: 'folder', color: 'text-amber-400', bg: 'bg-amber-400/10' },
                edge: { name: 'Microsoft Edge', icon: 'globe', color: 'text-sky-400', bg: 'bg-sky-400/10' },
                paint: { name: 'Microsoft Paint', icon: 'palette', color: 'text-pink-400', bg: 'bg-pink-400/10' },
                music: { name: 'Windows Media Player', icon: 'music', color: 'text-purple-400', bg: 'bg-purple-400/10' },
                arcade: { name: 'Void Arcade', icon: 'gamepad-2', color: 'text-green-400', bg: 'bg-green-400/10' },
                settings: { name: 'Settings', icon: 'settings', color: 'text-zinc-400', bg: 'bg-zinc-400/10' }
            }
        };

        function init() {
            renderDesktop();
            renderTaskbar();
            updateClock();
            document.getElementById('desktop-bg').style.backgroundImage = `url(${state.wallpaper})`;
            setInterval(updateClock, 1000);
            lucide.createIcons();

            document.addEventListener('click', (e) => {
                if (!e.target.closest('#start-menu') && !e.target.closest('button')) hideStart();
            });
            
            // Context Menu for Desktop
            document.getElementById('desktop').oncontextmenu = (e) => {
                if (e.target.id !== 'desktop') return;
                e.preventDefault();
                createNewFolder(e.clientX, e.clientY);
            };
        }

        function createNewFolder(x = 100, y = 100) {
            const id = 'folder_' + Date.now();
            state.folders.push({ id, name: 'New Folder', x, y });
            localStorage.setItem('w12_folders', JSON.stringify(state.folders));
            renderDesktop();
        }

        function renderDesktop() {
            const container = document.getElementById('desktop-icons');
            let html = '';
            
            // Apps
            Object.entries(state.apps).forEach(([id, app]) => {
                html += `
                <div ondblclick="openApp('${id}')" class="w-24 p-4 flex flex-col items-center gap-2 rounded-2xl hover:bg-white/10 cursor-pointer group transition-all">
                    <div class="w-14 h-14 ${app.bg} rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-105 transition-transform">
                        <i data-lucide="${app.icon}" class="w-7 h-7 ${app.color}"></i>
                    </div>
                    <span class="text-[10px] font-bold text-white text-center drop-shadow-md">${app.name}</span>
                </div>`;
            });

            // Folders
            state.folders.forEach(folder => {
                html += `
                <div ondblclick="openFolder('${folder.id}', '${folder.name}')" class="w-24 p-4 flex flex-col items-center gap-2 rounded-2xl hover:bg-white/10 cursor-pointer group transition-all">
                    <div class="w-14 h-14 bg-amber-400/10 rounded-2xl flex items-center justify-center shadow-lg group-hover:scale-105 transition-transform">
                        <i data-lucide="folder" class="w-7 h-7 text-amber-400"></i>
                    </div>
                    <span class="text-[10px] font-bold text-white text-center drop-shadow-md">${folder.name}</span>
                </div>`;
            });

            container.innerHTML = html;
            lucide.createIcons();
        }

        window.openApp = (id) => {
            // "Islinged" check - can open multiple if we don't return early, 
            // but usually core apps are single-instance. 
            // Folders however will be multi-instance.
            if (state.openWindows.find(w => w.id === id)) return focusWindow(id);
            createWindow(id, id, state.apps[id].name, state.apps[id].icon, state.apps[id].color);
        };

        window.openFolder = (folderId, name) => {
            // Folders are always unique instances
            const instanceId = `win_${folderId}_${Date.now()}`;
            createWindow(instanceId, 'explorer', name, 'folder', 'text-amber-400');
        };

        function createWindow(uniqueId, type, title, icon, colorClass) {
            state.openWindows.push({ id: uniqueId, type, title });
            
            const win = document.createElement('div');
            win.id = uniqueId;
            win.className = `window-instance fixed top-[15%] left-[20%] w-[900px] h-[580px] rounded-[32px] overflow-hidden shadow-2xl glass flex flex-col pointer-events-auto z-50`;
            
            win.innerHTML = `
                <div class="h-14 flex items-center justify-between px-6 border-b border-white/5 cursor-move win-header">
                    <div class="flex items-center gap-3">
                        <i data-lucide="${icon}" class="w-4 h-4 ${colorClass}"></i>
                        <span class="text-[11px] font-bold text-white/70 uppercase tracking-widest">${title}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="closeWindow('${uniqueId}')" class="w-8 h-8 rounded-full hover:bg-red-500/80 flex items-center justify-center transition group"><i data-lucide="x" class="w-4 h-4 text-white/50 group-hover:text-white"></i></button>
                    </div>
                </div>
                <div class="flex-1 overflow-hidden relative bg-black/20" id="content-${uniqueId}">
                    ${renderAppContent(type)}
                </div>
            `;
            
            document.getElementById('window-container').appendChild(win);
            lucide.createIcons();
            makeDraggable(win);
            focusWindow(uniqueId);
            renderTaskbar();

            // Init specific app logic
            setTimeout(() => {
                if (type === 'paint') initPaint(uniqueId);
                if (type === 'arcade') initArcade(uniqueId);
                if (type === 'music') initMusic(uniqueId);
            }, 50);
        }

        function renderAppContent(type) {
            switch(type) {
                case 'explorer': return `
                    <div class="p-12 grid grid-cols-5 gap-8">
                        <div class="flex flex-col items-center gap-3 p-6 rounded-3xl hover:bg-white/5 cursor-pointer border border-transparent hover:border-white/10 transition">
                            <i data-lucide="file-text" class="w-12 h-12 text-blue-400"></i>
                            <span class="text-[10px] text-white/60 font-bold uppercase tracking-tighter">System_Log.txt</span>
                        </div>
                        <div class="flex flex-col items-center gap-3 p-6 rounded-3xl hover:bg-white/5 cursor-pointer border border-transparent hover:border-white/10 transition">
                            <i data-lucide="image" class="w-12 h-12 text-purple-400"></i>
                            <span class="text-[10px] text-white/60 font-bold uppercase tracking-tighter">Wallpaper_HD.png</span>
                        </div>
                    </div>`;
                case 'music': return `
                    <div class="flex flex-col h-full p-12 text-white">
                        <div class="flex items-center gap-10 mb-12">
                            <div class="w-48 h-48 rounded-[40px] bg-gradient-to-br from-indigo-600 to-purple-700 flex items-center justify-center animate-float shadow-2xl">
                                <i data-lucide="music" class="w-20 h-20"></i>
                            </div>
                            <div>
                                <h2 class="text-4xl font-black mb-2">Sonic Horizon</h2>
                                <p class="opacity-40 font-bold uppercase text-[10px] tracking-[0.4em]">Now Playing: Synthwave Mix</p>
                            </div>
                        </div>
                        <div class="flex-1 flex items-end gap-1.5" id="viz-container">
                            ${Array(40).fill(0).map(() => `<div class="music-bar flex-1 bg-indigo-500/50 rounded-t-full" style="height: 10%"></div>`).join('')}
                        </div>
                    </div>`;
                case 'arcade': return `
                    <div class="h-full relative flex flex-col bg-slate-950">
                        <div class="absolute top-6 left-6 text-white z-10">
                            <span class="text-xs font-black opacity-30 tracking-widest uppercase">Score: <span id="score" class="opacity-100">0</span></span>
                        </div>
                        <canvas class="flex-1 w-full" id="arcade-canvas"></canvas>
                    </div>`;
                case 'paint': return `
                    <div class="flex flex-col h-full bg-zinc-900">
                        <div class="h-16 border-b border-white/5 flex items-center px-6 gap-6">
                            <input type="color" id="p-color" class="w-8 h-8 rounded-full border-none bg-transparent cursor-pointer" value="#6366f1">
                            <input type="range" id="p-size" min="1" max="50" value="5" class="w-32 accent-indigo-500">
                            <button onclick="this.closest('.window-instance').querySelector('canvas').getContext('2d').clearRect(0,0,2000,2000)" class="text-[10px] font-bold text-white/40 hover:text-white">CLEAR</button>
                        </div>
                        <canvas class="flex-1 bg-white m-4 rounded-2xl"></canvas>
                    </div>`;
                case 'edge': return `<iframe src="https://www.google.com/webhp?igu=1" class="w-full h-full border-none bg-white"></iframe>`;
                default: return `<div class="p-12 text-white/20 font-black text-center">Empty Directory</div>`;
            }
        }

        // --- App Specific Inits ---
        function initMusic(winId) {
            const bars = document.getElementById(winId).querySelectorAll('.music-bar');
            function anim() {
                if (!document.getElementById(winId)) return;
                bars.forEach(b => b.style.height = (10 + Math.random() * 80) + '%');
                setTimeout(anim, 150);
            }
            anim();
        }

        function initPaint(winId) {
            const canvas = document.getElementById(winId).querySelector('canvas');
            const ctx = canvas.getContext('2d');
            let drawing = false;
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            ctx.lineCap = 'round';
            canvas.onmousedown = () => drawing = true;
            canvas.onmouseup = () => { drawing = false; ctx.beginPath(); };
            canvas.onmousemove = (e) => {
                if(!drawing) return;
                const rect = canvas.getBoundingClientRect();
                ctx.lineWidth = document.getElementById(winId).querySelector('#p-size').value;
                ctx.strokeStyle = document.getElementById(winId).querySelector('#p-color').value;
                ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
            };
        }

        function initArcade(winId) {
            const canvas = document.getElementById(winId).querySelector('canvas');
            const ctx = canvas.getContext('2d');
            const scoreDisplay = document.getElementById(winId).querySelector('#score');
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            
            let player = { x: canvas.width/2, y: canvas.height - 50, r: 15 };
            let score = 0;
            let obstacles = [];

            function loop() {
                if (!document.getElementById(winId)) return;
                ctx.clearRect(0,0, canvas.width, canvas.height);
                
                // Draw player
                ctx.fillStyle = '#6366f1';
                ctx.beginPath(); ctx.arc(player.x, player.y, player.r, 0, Math.PI*2); ctx.fill();

                if (Math.random() < 0.05) obstacles.push({ x: Math.random() * canvas.width, y: -20, r: 10 + Math.random()*20 });

                obstacles.forEach((obs, i) => {
                    obs.y += 5;
                    ctx.fillStyle = '#ef4444';
                    ctx.beginPath(); ctx.arc(obs.x, obs.y, obs.r, 0, Math.PI*2); ctx.fill();
                    
                    if (obs.y > canvas.height) { obstacles.splice(i, 1); score++; scoreDisplay.innerText = score; }
                    
                    // Simple collision
                    if (Math.hypot(player.x - obs.x, player.y - obs.y) < player.r + obs.r) {
                        score = 0; scoreDisplay.innerText = "CRASHED"; obstacles = [];
                    }
                });

                canvas.onmousemove = (e) => {
                    const rect = canvas.getBoundingClientRect();
                    player.x = e.clientX - rect.left;
                };

                requestAnimationFrame(loop);
            }
            loop();
        }

        // --- System Logic ---
        window.closeWindow = (id) => {
            state.openWindows = state.openWindows.filter(w => w.id !== id);
            document.getElementById(id).remove();
            renderTaskbar();
        };

        window.focusWindow = (id) => {
            const win = document.getElementById(id);
            if(!win) return;
            document.querySelectorAll('.window-instance').forEach(w => w.style.zIndex = 50);
            win.style.zIndex = 100;
            state.activeWindow = id;
            renderTaskbar();
        };

        function renderTaskbar() {
            const container = document.getElementById('taskbar-apps');
            container.innerHTML = state.openWindows.map(win => `
                <button onclick="focusWindow('${win.id}')" class="relative w-14 h-14 rounded-[22px] flex items-center justify-center transition hover:bg-white/10 ${state.activeWindow === win.id ? 'bg-white/10' : ''}">
                    <i data-lucide="${state.apps[win.type]?.icon || 'folder'}" class="w-7 h-7 ${state.apps[win.type]?.color || 'text-amber-400'}"></i>
                    ${state.activeWindow === win.id ? '<div class="absolute bottom-1.5 w-1.5 h-1.5 bg-white rounded-full"></div>' : ''}
                </button>
            `).join('');
            lucide.createIcons();
        }

        window.toggleStart = (e) => { 
            e.stopPropagation(); 
            document.getElementById('start-menu').classList.toggle('hidden'); 
            renderStartGrid(); 
        };

        function renderStartGrid() {
            const grid = document.getElementById('start-grid');
            grid.innerHTML = Object.entries(state.apps).map(([id, app]) => `
                <div onclick="openApp('${id}')" class="flex flex-col items-center gap-4 cursor-pointer p-4 rounded-3xl hover:bg-white/5 transition active:scale-95">
                    <div class="w-16 h-16 ${app.bg} rounded-2xl flex items-center justify-center">
                        <i data-lucide="${app.icon}" class="w-8 h-8 ${app.color}"></i>
                    </div>
                    <span class="text-[9px] font-bold text-white/60 uppercase tracking-widest">${app.name.split(' ')[0]}</span>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('taskbar-time').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false });
            document.getElementById('taskbar-date').innerText = now.toLocaleDateString([], { month: 'short', day: 'numeric' }).toUpperCase();
        }

        function hideStart() { document.getElementById('start-menu').classList.add('hidden'); }

        function makeDraggable(el) {
            const header = el.querySelector('.win-header');
            let p1=0, p2=0, p3=0, p4=0;
            header.onmousedown = (e) => {
                focusWindow(el.id);
                e.preventDefault();
                p3 = e.clientX; p4 = e.clientY;
                document.onmousemove = (e) => {
                    p1 = p3 - e.clientX; p2 = p4 - e.clientY;
                    p3 = e.clientX; p4 = e.clientY;
                    el.style.top = (el.offsetTop - p2) + "px";
                    el.style.left = (el.offsetLeft - p1) + "px";
                };
                document.onmouseup = () => { document.onmousemove = null; document.onmouseup = null; };
            };
        }

        window.onload = init;
    </script>
</body>
</html>
